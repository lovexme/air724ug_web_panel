import{d as J,N as M,O as A,x as C,P as se,h as y,r as p,y as X,j as Z,M as fe,v as de,z as ve,A as pe,H as x,a as D,Q as ge,D as me,E as he,K as N,_ as ye}from"./index-DjoOmC4i.js";import{m as we}from"./monaco-editor-NzCLzzz0.js";import{B as be}from"./index-Cwv6z3sq.js";import{s as m}from"./function-call-BeIUeiMk.js";import{b as q}from"./route-block-B_A1xBdJ.js";function Oe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?B(Object(r),!0).forEach(function(n){Oe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function je(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,o;for(o=0;o<n.length;o++)a=n[o],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Se(e,t){if(e==null)return{};var r=je(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _e(e,t){return Pe(e)||Me(e,t)||$e(e,t)||Ee()}function Pe(e){if(Array.isArray(e))return e}function Me(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,o=void 0;try{for(var c=e[Symbol.iterator](),i;!(n=(i=c.next()).done)&&(r.push(i.value),!(t&&r.length===t));n=!0);}catch(l){a=!0,o=l}finally{try{!n&&c.return!=null&&c.return()}finally{if(a)throw o}}return r}}function $e(e,t){if(e){if(typeof e=="string")return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U(e,t)}}function U(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ee(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ie(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?z(Object(r),!0).forEach(function(n){Ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Te(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(a,o){return o(a)},n)}}function h(e){return function t(){for(var r=this,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var c=arguments.length,i=new Array(c),l=0;l<c;l++)i[l]=arguments[l];return t.apply(r,[].concat(a,i))}}}function S(e){return{}.toString.call(e).includes("Object")}function Ce(e){return!Object.keys(e).length}function w(e){return typeof e=="function"}function ke(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function We(e,t){return S(t)||d("changeType"),Object.keys(t).some(function(r){return!ke(e,r)})&&d("changeField"),t}function Ae(e){w(e)||d("selectorType")}function Ve(e){w(e)||S(e)||d("handlerType"),S(e)&&Object.values(e).some(function(t){return!w(t)})&&d("handlersType")}function xe(e){e||d("initialIsRequired"),S(e)||d("initialType"),Ce(e)&&d("initialContent")}function De(e,t){throw new Error(e[t]||e.default)}var Ne={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},d=h(De)(Ne),j={changes:We,selector:Ae,handler:Ve,initial:xe};function qe(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};j.initial(e),j.handler(t);var r={current:e},n=h(Ue)(r,t),a=h(Le)(r),o=h(j.changes)(e),c=h(Be)(r);function i(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(u){return u};return j.selector(s),s(r.current)}function l(s){Te(n,a,o,c)(s)}return[i,l]}function Be(e,t){return w(t)?t(e.current):t}function Le(e,t){return e.current=H(H({},e.current),t),t}function Ue(e,t,r){return w(t)?t(e.current):Object.keys(r).forEach(function(n){var a;return(a=t[n])===null||a===void 0?void 0:a.call(t,e.current[n])}),r}var ze={create:qe},He={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function Fe(e){return function t(){for(var r=this,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var c=arguments.length,i=new Array(c),l=0;l<c;l++)i[l]=arguments[l];return t.apply(r,[].concat(a,i))}}}function Ke(e){return{}.toString.call(e).includes("Object")}function Re(e){return e||F("configIsRequired"),Ke(e)||F("configType"),e.urls?(Ge(),{paths:{vs:e.urls.monacoBase}}):e}function Ge(){console.warn(ee.deprecation)}function Qe(e,t){throw new Error(e[t]||e.default)}var ee={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},F=Fe(Qe)(ee),Ye={config:Re},Je=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(a){return r.reduceRight(function(o,c){return c(o)},a)}};function te(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],te(e[r],t[r]))}),L(L({},e),t)}var Xe={type:"cancelation",msg:"operation is manually canceled"};function $(e){var t=!1,r=new Promise(function(n,a){e.then(function(o){return t?a(Xe):n(o)}),e.catch(a)});return r.cancel=function(){return t=!0},r}var Ze=ze.create({config:He,isInitialized:!1,resolve:null,reject:null,monaco:null}),re=_e(Ze,2),b=re[0],_=re[1];function et(e){var t=Ye.config(e),r=t.monaco,n=Se(t,["monaco"]);_(function(a){return{config:te(a.config,n),monaco:r}})}function tt(){var e=b(function(t){var r=t.monaco,n=t.isInitialized,a=t.resolve;return{monaco:r,isInitialized:n,resolve:a}});if(!e.isInitialized){if(_({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),$(E);if(window.monaco&&window.monaco.editor)return ne(window.monaco),e.resolve(window.monaco),$(E);Je(rt,at)(ot)}return $(E)}function rt(e){return document.body.appendChild(e)}function nt(e){var t=document.createElement("script");return e&&(t.src=e),t}function at(e){var t=b(function(n){var a=n.config,o=n.reject;return{config:a,reject:o}}),r=nt("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function ot(){var e=b(function(r){var n=r.config,a=r.resolve,o=r.reject;return{config:n,resolve:a,reject:o}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){ne(r),e.resolve(r)},function(r){e.reject(r)})}function ne(e){b().monaco||_({monaco:e})}function it(){return b(function(e){var t=e.monaco;return t})}var E=new Promise(function(e,t){return _({resolve:e,reject:t})}),k={config:et,init:tt,__getMonacoInstance:it},ut=Object.defineProperty,ct=Object.defineProperties,lt=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable,R=(e,t,r)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))st.call(t,r)&&R(e,r,t[r]);if(K)for(var r of K(t))ft.call(t,r)&&R(e,r,t[r]);return e},dt=(e,t)=>ct(e,lt(t));const T={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function vt(e,t){const r=C(()=>{const{width:a,height:o}=e;return dt(I({},T.wrapper),{width:a,height:o})}),n=C(()=>I(I({},T.fullWidth),!t.value&&T.hide));return{wrapperStyle:r,containerStyle:n}}function pt(){const e=A(k.__getMonacoInstance()),t=p(!1);let r;return X(()=>{e.value||(r=k.init(),r.then(a=>e.value=a).catch(a=>{(a==null?void 0:a.type)!=="cancelation"&&(t.value=!0,console.error("Monaco initialization error:",a))}))}),{monacoRef:e,unload:()=>r==null?void 0:r.cancel(),isLoadFailed:t}}function G(e){return typeof e=="function"?e():e}function W(e){return e===void 0}function ae(e,t,r,n){return gt(e,n)||mt(e,t,r,n)}function gt(e,t){return e.editor.getModel(oe(e,t))}function mt(e,t,r,n){return e.editor.createModel(t,r,n?oe(e,n):void 0)}function oe(e,t){return e.Uri.parse(t)}var ht=Object.defineProperty,Q=Object.getOwnPropertySymbols,yt=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable,Y=(e,t,r)=>t in e?ht(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bt=(e,t)=>{for(var r in t||(t={}))yt.call(t,r)&&Y(e,r,t[r]);if(Q)for(var r of Q(t))wt.call(t,r)&&Y(e,r,t[r]);return e};const Ot={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var jt=J({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(e,t){const r=new Map,n=A(null),{monacoRef:a,unload:o,isLoadFailed:c}=pt(),{editorRef:i}=St(t,e,a,n),{disposeValidator:l}=_t(t,e,a,i),s=C(()=>!!a.value&&!!i.value),{wrapperStyle:u,containerStyle:O}=vt(e,s);return se(()=>{var f,v;(f=l.value)==null||f.call(l),i.value?((v=i.value.getModel())==null||v.dispose(),i.value.dispose()):o()}),y([()=>e.path,()=>e.value,()=>e.language,()=>e.line],([f,v,P,g],[V,Wt,ue,ce])=>{if(s.value){if(f!==V){const le=ae(a.value,v||e.defaultValue||"",P||e.defaultLanguage||"",f||e.defaultPath||"");e.saveViewState&&r.set(V,i.value.saveViewState()),i.value.setModel(le),e.saveViewState&&i.value.restoreViewState(r.get(f)),W(g)||i.value.revealLine(g);return}i.value.getValue()!==v&&i.value.setValue(v),P!==ue&&a.value.editor.setModelLanguage(i.value.getModel(),P),!W(g)&&g!==ce&&i.value.revealLine(g)}}),y(()=>e.options,f=>i.value&&i.value.updateOptions(f),{deep:!0}),y(()=>e.theme,f=>a.value&&a.value.editor.setTheme(f)),{containerRef:n,isEditorReady:s,isLoadFailed:c,wrapperStyle:u,containerStyle:O}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:r,wrapperStyle:n,containerStyle:a,className:o}=this;return M("div",{style:n},[!t&&M("div",{style:Ot},r?e.failure?G(e.failure):"load failed":e.default?G(e.default):"loading..."),M("div",{ref:"containerRef",key:"monaco_editor_container",style:a,class:o})])}});function St({emit:e},t,r,n){const a=A(null);X(()=>{const c=y(r,()=>{n.value&&r.value&&(Z(()=>c()),o())},{immediate:!0})});function o(){var c;if(!n.value||!r.value||a.value)return;e("beforeMount",r.value);const i=t.path||t.defaultPath,l=ae(r.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",i||"");a.value=r.value.editor.create(n.value,bt({model:l,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),(c=a.value)==null||c.onDidChangeModelContent(s=>{const u=a.value.getValue();u!==t.value&&(e("update:value",u),e("change",u,s))}),a.value&&!W(t.line)&&a.value.revealLine(t.line),e("mount",a.value,r.value)}return{editorRef:a}}function _t({emit:e},t,r,n){const a=p(null),o=y([r,n],()=>{if(r.value&&n.value){Z(()=>o());const c=r.value.editor.onDidChangeMarkers(i=>{var l,s;const u=(s=(l=n.value)==null?void 0:l.getModel())==null?void 0:s.uri;if(u&&i.find(f=>f.path===u.path)){const f=r.value.editor.getModelMarkers({resource:u});e("validate",f)}});a.value=()=>c==null?void 0:c.dispose()}});return{disposeValidator:a}}function Pt(e){return new Worker("/assets/editor.worker-BF8sMY45.js",{name:e==null?void 0:e.name})}function Mt(e){return new Worker("/assets/json.worker-BoBKUCni.js",{name:e==null?void 0:e.name})}function $t(e){return new Worker("/assets/css.worker-CffjfGaH.js",{name:e==null?void 0:e.name})}function Et(e){return new Worker("/assets/html.worker-BnkIKlUq.js",{name:e==null?void 0:e.name})}function It(e){return new Worker("/assets/ts.worker-58P_SjQh.js",{name:e==null?void 0:e.name})}const Tt={class:"config-edit-page"},Ct={class:"editor-container"},kt={class:"footer"},ie=J({__name:"index",setup(e){globalThis.MonacoEnvironment={getWorker(s,u){return u==="json"?new Mt:u==="css"||u==="scss"||u==="less"?new $t:u==="html"||u==="handlebars"||u==="razor"?new Et:u==="typescript"||u==="javascript"?new It:new Pt}},k.config({monaco:we});const t=fe(),r=de(),n=p(t.query.device?JSON.parse(t.query.device):{}),a=p(""),o=p(!1),c=p(0);async function i(){var s;if((s=n.value)!=null&&s.imei){o.value=!0;try{const u=await N.post("/executeTask",{imei:n.value.imei,task:"get_config"});u.success?a.value=u.result||"":m("获取配置失败")}catch(u){m("获取配置失败")}finally{o.value=!1,c.value=2}}}async function l(){var s;if((s=n.value)!=null&&s.imei){o.value=!0;try{(await N.post("/executeTask",{imei:n.value.imei,task:"set_config",configText:a.value})).success?(m("保存成功"),r.back()):m("保存失败")}catch(u){m("保存失败")}finally{o.value=!1}}}return i(),(s,u)=>{const O=be;return pe(),ve("div",Tt,[x("div",Ct,[D(ge(jt),{value:a.value,"onUpdate:value":u[0]||(u[0]=f=>a.value=f),language:"lua",theme:"vs-dark",options:{fontSize:14}},null,8,["value"])]),x("div",kt,[D(O,{block:"",type:"primary",loading:o.value,onClick:l},{default:me(()=>u[1]||(u[1]=[he(" 保存配置 ")])),_:1,__:[1]},8,["loading"])])])}}});typeof q=="function"&&q(ie);const qt=ye(ie,[["__scopeId","data-v-12f65444"]]);export{qt as default};
